//6x4
char fish11[] = {0x0,0x50,0x0,0x5,0x55,0x5,0x54,0x55,0x50,0x5,0x59,0x5};
char fish12[] = {0x0,0x50,0x0,0x5,0x55,0x9,0x54,0xd5,0x59,0x5,0x59,0x9};
int fish1[] = {fish11, fish12};

//10x6
char fish21[] = {0x0,0x0,0xd0,0x0,0x0,0x0,0x55,0x55,0x0,0x5,0x5,0xb5,0x55,0x50,0x55,0x95,0x55,0x55,0x55,0x50,0x9,0x5d,0x55,0x90,0x55,0x0,0x95,0x59,0x0,0x9};
char fish22[] = {0x0,0x0,0xd0,0x0,0x0,0x0,0x55,0x55,0x0,0x0,0x5,0xb5,0x55,0x50,0x55,0x95,0x5d,0x55,0x55,0x55,0x9,0x55,0x55,0x90,0x95,0x0,0x95,0x59,0x0,0x0};
int fish2[] = {fish21, fish22};

//14x8
char fish31[] = {0x0,0x0,0x0,0xd0,0x0,0x0,0x0,0x0,0x5,0x59,0x59,0x50,0x0,0x50,0x0,0x5b,0x59,0x59,0x55,0x5,0x50,0x5,0x55,0x55,0x55,0x55,0x55,0x0,0x99,0x55,0xd5,0x55,0x55,0x55,0x0,0x0,0x95,0x5d,0x55,0x59,0x5,0x50,0x0,0x9,0x95,0x55,0x50,0x0,0x59,0x0,0x0,0x0,0x9,0x0,0x0,0x9};
char fish32[] = {0x0,0x0,0x0,0xd0,0x0,0x0,0x0,0x0,0x5,0x59,0x59,0x50,0x0,0x5d,0x0,0x5b,0x59,0x59,0x55,0x5,0xdd,0x5,0x55,0x55,0x55,0x55,0x55,0x0,0x99,0x55,0xdd,0x55,0x55,0x55,0xd0,0x0,0x95,0x55,0x55,0x59,0x5,0x5d,0x0,0x9,0x95,0x55,0x50,0x0,0x59,0x0,0x0,0x0,0x90,0x0,0x0,0x0};
int fish3[] = {fish31, fish32};

//18x8
char fish41[] = {0x0,0x0,0x0,0xdd,0xdd,0xd0,0x0,0x0,0x0,0x0,0x5,0x59,0x59,0x59,0x59,0x55,0x0,0x5,0x0,0x5b,0x59,0x59,0x59,0x59,0x55,0x50,0x55,0x5,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x50,0x99,0x55,0xdd,0x55,0x55,0x55,0x55,0x55,0x50,0x0,0x95,0x55,0x55,0x59,0x59,0x55,0x50,0x50,0x0,0x9,0x95,0x55,0x55,0x59,0x55,0x0,0x55,0x0,0x0,0x0,0x0,0x90,0x0,0x0,0x0,0x9};
char fish42[] = {0x0,0x0,0x0,0xdd,0xdd,0xd0,0x0,0x0,0x0,0x0,0x5,0x59,0x59,0x59,0x59,0x55,0x0,0x0,0x0,0x5b,0x59,0x59,0x59,0x59,0x55,0x50,0x5d,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x5d,0x0,0x55,0xd5,0x55,0x55,0x55,0x55,0x55,0x50,0x99,0x95,0x5d,0x55,0x59,0x59,0x55,0x50,0x5d,0x0,0x99,0x95,0x55,0x55,0x59,0x55,0x0,0x9,0x0,0x0,0x0,0x9,0x0,0x0,0x0,0x0,0x0};
int fish4[] = {fish41, fish42};

//10x12
char plants1[] = {0x5d,0x0,0x0,0x0,0x0,0x5d,0xd0,0x0,0x0,0x0,0x5,0xdd,0x0,0x0,0x5,0x0,0x55,0x0,0x0,0xd5,0x0,0x0,0x50,0xd,0xd5,0x0,0x0,0x50,0xdd,0x50,0x5d,0x0,0x50,0x55,0x0,0x5d,0xd0,0x55,0x0,0x0,0x5,0xd0,0x5,0x0,0x0,0x0,0x55,0x5,0x0,0x0,0x0,0x0,0x55,0x0,0x0,0x0,0x0,0x50,0x0,0x0};
char plants2[] = {0xd,0x0,0x0,0x0,0x0,0x5,0xd0,0x0,0x0,0x0,0x5,0xdd,0xd0,0x0,0x0,0x0,0x55,0x50,0x0,0xd5,0x0,0x0,0x5,0x0,0xd5,0x5,0x0,0x50,0xd,0xd5,0x5,0xd0,0x50,0x55,0x50,0x5,0xd0,0x55,0x0,0x0,0x0,0x5d,0x5,0x0,0x0,0x0,0x55,0x5,0x0,0x0,0x0,0x0,0x55,0x0,0x0,0x0,0x0,0x50,0x0,0x0};
int plants[] = {plants1, plants2};

//16x8rle
char wave[] = {0x20,0x33,0x8,0x11,0x18,0x66};
	
//32x32rle
char deadFish[] = {0x11,0x66,0x86,0x95,0x55,0x59,0x55,0xc6,0xa,0x66,0x87,0x69,0x99,0x55,0x99,0x95,0x5c,0x4,0x66,0x8b,0x61,0x66,0x16,0x66,0x61,0x66,0x65,0x99,0x95,0x59,0x2,0x55,0x82,0x9c,0x7,0x66,0x2,0x16,0x84,0x65,0x59,0x99,0x3,0x55,0x83,0x95,0x96,0x6,0x66,0x86,0x61,0x66,0x65,0x55,0x99,0x2,0x55,0x85,0x59,0x5d,0xdd,0x77,0x3,0x66,0x82,0x61,0x3,0x66,0x82,0x65,0x2,0x55,0x85,0x59,0x55,0x95,0x55,0x2,0xdd,0x82,0x76,0x2,0x66,0x2,0x16,0x2,0x66,0x82,0x65,0x2,0x55,0x88,0x95,0x59,0x55,0x59,0x5d,0xdd,0xd7,0x2,0x66,0x82,0x61,0x3,0x66,0x82,0x65,0x2,0x99,0x88,0x55,0x95,0x55,0x95,0x59,0xdd,0xd6,0x6,0x66,0x83,0x6b,0x5b,0x3,0x55,0x86,0x59,0x55,0x59,0x5d,0xd6,0x4,0x66,0x85,0x61,0x66,0x6b,0xb5,0x3,0x55,0x86,0x95,0x55,0x95,0x55,0xc6,0x6,0x66,0x82,0x6b,0x2,0x5b,0x82,0xd7,0x2,0x55,0x82,0x59,0x2,0x55,0x82,0xc6,0x3,0x66,0x82,0x16,0x3,0x66,0x8a,0xb5,0xbd,0xdd,0x75,0x55,0x95,0x55,0x95,0xc6,0x7,0x66,0x85,0x6b,0x5d,0xdd,0xd7,0x2,0x55,0x84,0x59,0x55,0x5c,0x8,0x66,0x84,0xbd,0x7d,0xd7,0x2,0x55,0x84,0x95,0x55,0x5c,0x8,0x66,0x84,0x6d,0x7d,0xd7,0x4,0x55,0x82,0x5c,0x8,0x66,0x85,0x6d,0x7d,0xd7,0xb5,0x3,0x55,0x82,0x5c,0x8,0x66,0x84,0x6d,0xdd,0x7b,0x4,0x55,0x85,0x5c,0x66,0x6c,0xcc,0x5,0x66,0x83,0x6d,0xd7,0x3,0xb5,0x5,0x55,0x83,0x95,0xc6,0x4,0x66,0x85,0x6d,0x76,0x6b,0x5b,0x2,0x55,0x83,0x95,0x55,0x2,0x99,0x83,0x55,0x5c,0x7,0x66,0x3,0xb5,0x82,0x59,0x3,0x55,0x84,0x59,0x55,0xc6,0x6,0x66,0x84,0x6b,0x5b,0x59,0x2,0x55,0x86,0x99,0x95,0x55,0x95,0x5c,0x7,0x66,0x2,0xb5,0x82,0x95,0x2,0x55,0x82,0x59,0x2,0x55,0x82,0x56,0x9,0x66,0x6,0x55,0x9,0x66,0x84,0x65,0x59,0x55,0x2,0x66,0x83,0x55,0x56,0x9,0x66,0x82,0x65,0x2,0x95,0xd,0x66,0x2,0x59,0x82,0x55,0xd,0x66,0x84,0xb5,0x59,0x56,0xd,0x66,0x84,0xb5,0x55,0x56,0xd,0x66,0x83,0x6b,0x5b,0xf,0x66,0x82,0xb6,0x17,0x66};
char fishFry[] = {0x4b,0x66,0x83,0x6d,0xdd,0x2,0x66,0x82,0xd6,0xa,0x66,0x82,0x55,0x2,0x95,0x84,0x56,0x6d,0xd6,0x3,0x66,0x83,0x6d,0xd6,0x4,0x66,0x83,0x65,0xb5,0x2,0x95,0x2,0x55,0x4,0x66,0x2,0x59,0x82,0x56,0x3,0x66,0x2,0x55,0x2,0x95,0x83,0x55,0x5d,0x2,0x66,0x2,0x69,0x2,0x59,0x83,0x55,0x56,0x2,0x66,0x83,0x65,0x5d,0x3,0x55,0x83,0x6d,0xd6,0x2,0x66,0x82,0x95,0x2,0x59,0x83,0x55,0xb5,0x3,0x66,0x87,0x55,0xd5,0x55,0x56,0x66,0xd6,0x2,0x66,0x82,0x95,0x4,0x55,0x82,0x56,0x9,0x66,0x2,0x69,0x2,0x55,0x83,0xd5,0x55,0xc,0x66,0x84,0x95,0x5d,0x55,0x22,0x66,0x82,0x65,0xf,0x66,0x83,0xdd,0x6d,0x3,0x66,0x82,0x56,0x9,0x66,0x84,0x6d,0x9d,0xd6,0x2,0x66,0x83,0xd6,0xdd,0xa,0x66,0x83,0xdd,0x6d,0x2,0x66,0x84,0x6d,0xd9,0xd6,0xd,0x66,0x83,0xd6,0xdd,0xa,0x66,0x82,0xd6,0xc,0x66,0x82,0x56,0x2,0x66,0x82,0xd6,0x8,0x66,0x82,0x6d,0x2,0x66,0x82,0x6d,0x2,0xd6,0x83,0x6d,0xd6,0x5,0x66,0x82,0xd6,0x2,0x66,0x82,0x6d,0x2,0x66,0x85,0xd9,0xdd,0x66,0x6d,0x6,0x66,0x82,0xd6,0x2,0x66,0x82,0x6d,0x2,0x66,0x82,0x6d,0x2,0xd6,0x82,0x6d,0x2,0x66,0x82,0x65,0x3,0x66,0x82,0xd6,0x2,0x66,0x82,0x6d,0x5,0x66,0x85,0x6d,0xd6,0x66,0xdd,0x2,0xd6,0x83,0x66,0xd6,0x2,0x66,0x85,0x6d,0x56,0x66,0x6d,0x3,0x66,0x88,0xd6,0x6d,0x9d,0xdd,0x66,0x6d,0xd6,0x3,0x66,0x85,0x56,0x66,0x6d,0xd6,0x2,0x66,0x84,0xd6,0x66,0xdd,0x2,0xd6,0x82,0x6d,0x4,0x66,0x82,0x56,0x2,0x66,0x82,0xd6,0x2,0x66,0x82,0x56,0x4,0x66,0x82,0x6d,0x4,0x66,0x85,0x56,0x66,0x6d,0xd6,0x2,0x66,0x82,0x56,0x2,0x66,0x82,0xd6,0x2,0x66,0x82,0xd6,0x2,0x66,0x85,0x6d,0x56,0x66,0x6d,0x3,0x66,0x82,0x56,0x2,0x66,0x82,0xdd,0x2,0x66,0x82,0xd6,0x2,0x66,0x82,0x6d,0x2,0x66,0x82,0x6d,0x3,0x66,0x82,0x56,0x2,0x66,0x82,0x6d,0x2,0x66,0x82,0xd6,0x2,0x66,0x82,0x6d,0x2,0x66,0x82,0x6d,0x3,0x66,0x82,0xd6,0x2,0x66,0x82,0x6d,0x2,0x66,0x82,0xd6,0x66};

//32x4
char healthbar[] = {0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11};

//2x2
char planktone1[] = {0x58,0x55};
char planktone2[] = {0x0,0x85};
int planktone[] = {planktone1, planktone2};
	
//6x3
char eatFish1[] = {0x70,0x77,0x0,0x7,0x74,0x70,0x70,0x77,0x0};
char eatFish2[] = {0x80,0x77,0x0,0x77,0x74,0x70,0x80,0x87,0x0};
int eatFish[] = {eatFish1, eatFish2};

//20x8
char shark1[] = {0x0,0x0,0x0,0x0,0x33,0x30,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x33,0x0,0x0,0x0,0x0,0x30,0x0,0x0,0x3,0x33,0x33,0x33,0x33,0xb3,0x33,0x33,0x0,0x0,0x33,0x33,0x93,0x93,0x11,0x11,0x10,0x3,0x30,0x33,0x33,0x33,0x93,0x91,0x0,0x0,0x0,0x0,0x33,0x33,0x33,0x33,0x33,0x11,0x11,0x10,0x0,0x3,0x0,0x0,0x33,0x33,0x31,0x11,0x11,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x30,0x3,0x0,0x0,0x0};
char shark2[] = {0x0,0x0,0x0,0x0,0x33,0x30,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x33,0x0,0x0,0x0,0x0,0x3,0x0,0x0,0x3,0x33,0x33,0x33,0x33,0xb3,0x33,0x3,0x30,0x0,0x33,0x33,0x93,0x93,0x11,0x11,0x10,0x3,0x30,0x99,0x33,0x33,0x93,0x91,0x90,0x0,0x0,0x0,0x39,0x99,0x33,0x33,0x31,0x11,0x10,0x0,0x0,0x0,0x30,0x0,0x93,0x33,0x11,0x11,0x11,0x0,0x0,0x3,0x0,0x0,0x0,0x3,0x0,0x3,0x0,0x0,0x0};
int shark[] = {shark1, shark2};

//14x18
char jellyfish1[] = {0x0,0x0,0x3,0x33,0x0,0x0,0x0,0x0,0x3,0x30,0x0,0x33,0x0,0x0,0x3,0x30,0x0,0x0,0x0,0x33,0x0,0x3e,0xe0,0x33,0x33,0x30,0xe,0x30,0x3,0xee,0xee,0xee,0xee,0xe3,0x0,0x0,0x33,0x33,0x33,0x33,0x30,0x0,0x0,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0xe,0x3,0x3,0xe,0x0,0x0,0x0,0x3,0xe,0xe,0x3,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0xe,0x3,0x3,0xe,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0x3,0xe,0xe,0x3,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0xe,0x3,0x3,0xe,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0x0,0xe,0xe,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x0,0x0,0x0};
char jellyfish2[] = {0x0,0x0,0x3,0x33,0x0,0x0,0x0,0x0,0x3,0x30,0x0,0x33,0x0,0x0,0x3,0x3e,0x0,0x0,0xe,0x33,0x0,0x3e,0xee,0x33,0x33,0x3e,0xee,0x30,0x3,0xee,0xee,0xee,0xee,0xe3,0x0,0x0,0x33,0x33,0x33,0x33,0x30,0x0,0x0,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0xe,0x3,0x3,0xe,0x0,0x0,0x0,0x3,0xe,0xe,0x3,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0xe0,0x3,0x3,0x0,0xe0,0x0,0x3,0x0,0x3,0x3,0x0,0x3,0x0,0xe0,0x0,0xe0,0x0,0xe0,0x0,0xe0,0x30,0x0,0x30,0x0,0x30,0x0,0x30,0xe,0x0,0x30,0x0,0x30,0xe,0x0,0x0,0x30,0x3,0x3,0x0,0x30,0x0,0x0,0x0,0xe,0xe,0x0,0x0,0x0,0x0,0x0,0x30,0x0,0x30,0x0,0x0};
int jellyfish[] = {jellyfish1, jellyfish2};

char music[] = "1812:d=4,o=6,b=225:8b5,8b5,8e.,8f#.,8g#.,8f#.,8e.,8f#.,g#.,e.,2e.,8b5,16b.5,8e.,8f#.,8g#.,8f#.,8e.,8f#.,g#.,e.,2e.,8c#,8c#,8f#.,8g#.,8f#.,8c#.,8a.5,8c#.,8f#.,8c#.,8a.5,8c#.,2f#.,8b5,16b5,8e.,8f#.,8e.,8b.5,8g#.5,8b.5,8e.,8c#.,8g#.5,8c#.,1e,8c#,8c#,8c#,2e,2c#.,8b5,16b.5,8b5,d#.,2b.5,16b.5,16b.5,8b5,32d,c#.,2e,2d#,2f#,e.,b,a#,a,g#,8g.,8f#.,8f.,8e.,d#,8d.,8c#.,32c,2b.5,1c,2c#.,2d#.,2e.,f#.,d#.,2e.,f#.,d#.,e.,d#.,e.,d#.,e.,d#.,e.,d#.,1e";

int x, y, cadr, key, health, fishWeight, game;
	
void drawHealth() {
	int i;

	for (i = 1; i < health / 4; i++) {
		healthbar[15 + i] = 0xaa;
		healthbar[31 + i] = 0xaa;
	}

	i = health / 4;

	for (i = 1; i < 15; i++) {
		healthbar[15 + i] = 0x0;
		healthbar[31 + i] = 0x0;
	}
}

void onEat() {
	spritesetvalue(1, S_SPEEDY, 0);
	spritesetvalue(1, S_SPEEDX, 0);

	if (spritegetvalue(1, S_COLLISION) < 8) {
		putsprite(spritegetvalue(1, S_COLLISION), 0, 8 + random(110));
		health += (5 - fishWeight);
	} else if (spritegetvalue(1, S_COLLISION) < 12) {
		if (fishWeight > 1) {
			putsprite(spritegetvalue(1, S_COLLISION), 122, 8 + random(110));
			health += (7 - fishWeight);
		}
	} else if (spritegetvalue(1, S_COLLISION) < 30) {
		game = 0;
	}
}

void init() {
	int i;
	setpallette(0,0x2f4);
	clearscreen();
	getsprite(1, fish11);
	spritesetvalue(1, S_WIDTH, 6);
	spritesetvalue(1, S_HEIGHT, 4);
	spritesetvalue(1, S_SOLID, 1);
	spritesetvalue(1, S_SPEEDY, 0);
	spritesetvalue(1, S_SPEEDX, 0);
	spritesetvalue(1, S_ON_COLLISION, onEat);
	putsprite(1, x, y);
	getsprite(27, jellyfish1);
	spritesetvalue(27, S_WIDTH, 14);
	spritesetvalue(27, S_HEIGHT, 18);
	spritesetvalue(27, S_SOLID, 1);
	spritesetvalue(27, S_SPEEDY, -2);
	spritesetvalue(27, S_SPEEDX, 0);
	spritesetvalue(27, S_ANGLE, 0);
	putsprite(27, 60, 110);
	getsprite(28, shark1);
	spritesetvalue(28, S_WIDTH, 20);
	spritesetvalue(28, S_HEIGHT, 8);
	spritesetvalue(28, S_SOLID, 0);
	spritesetvalue(28, S_SPEEDY, 0);
	spritesetvalue(28, S_SPEEDX, 0);
	spritesetvalue(28, S_FLIP_HORIZONTAL, 1);
	putsprite(28, 255, 5);
	getsprite(29, shark1);
	spritesetvalue(29, S_WIDTH, 20);
	spritesetvalue(29, S_HEIGHT, 8);
	spritesetvalue(29, S_SOLID, 0);
	spritesetvalue(29, S_SPEEDY, 0);
	spritesetvalue(29, S_SPEEDX, 0);
	putsprite(29, 255, 5);
	getsprite(31, healthbar);
	spritesetvalue(31, S_WIDTH, 32);
	spritesetvalue(31, S_HEIGHT, 4);
	spritesetvalue(31, S_SOLID, 0);
	spritesetvalue(31, S_SPEEDY, 0);
	spritesetvalue(31, S_SPEEDX, 0);
	spritesetvalue(31, S_IS_SCROLLED, 0);
	putsprite(31,2, 121);

	for (i = 2; i < 8; i++) {
		getsprite(i, planktone1);
		spritesetvalue(i, S_WIDTH, 2);
		spritesetvalue(i, S_HEIGHT, 2);
		putsprite(i, random(127), 8 + random(110));
	}

	for (i = 8; i < 12; i++) {
		getsprite(i, eatFish1);
		spritesetvalue(i, S_WIDTH, 6);
		spritesetvalue(i, S_HEIGHT, 3);
		spritesetvalue(i, S_SOLID, 1);
		spritesetvalue(i, S_SPEEDX, 1 - random(2));
		spritesetvalue(i, S_SPEEDY, 1 - random(2));
		putsprite(i, random(127), 8 + random(110));
	}

	x = 65;
	y = 60;
	health = 30;
	game = 1;
	fishWeight = 1;
	cadr = 0;
	drawHealth();
}

void testExit() {
	int i, nx, ny;

	for (i = 2; i < 8; i++) {
		nx = spritegetvalue(i, S_X) + (1 - random(2));
		ny = spritegetvalue(i, S_Y) + (1 - random(2));

		if (nx < 0)
			nx = 125;
		else if (nx > 125)
			nx = 0;

		if (ny < 8)
			ny = 8;
		else if (ny > 125)
			ny = 125;

		putsprite(i, nx, ny);
	}

	for (i = 8; i < 12; i++) {
		if (spritegetvalue(i, S_X) < 0)
			spritesetvalue(i, S_X, 124);
		else if (spritegetvalue(i, S_X) > 124)
			spritesetvalue(i, S_X, 0);

		if (spritegetvalue(i, S_Y) < 8)
			spritesetvalue(i, S_SPEEDY, 1);
		else if (spritegetvalue(i, S_Y) > 125)
			spritesetvalue(i, S_SPEEDY, -1);

		if (spritegetvalue(i, S_SPEEDX) > 0)
			spritesetvalue(i, S_FLIP_HORIZONTAL, 0);
		else
			spritesetvalue(i, S_FLIP_HORIZONTAL, 1);
	}

	if (spritegetvalue(27, S_Y) > 80)
		spritesetvalue(27, S_SPEEDY, -1);
}

void step() {
	int i, hx, hy;
	key = getkey();

	if (key & KEY_UP && y > 8)
		y--;

	if (key & KEY_DOWN && y < 120)
		y++;

	if (key & KEY_LEFT && x > 0) {
		spritesetvalue(1, S_FLIP_HORIZONTAL, 0);
		x--;
	}

	if (key & KEY_RIGHT && x < 121) {
		spritesetvalue(1, S_FLIP_HORIZONTAL, 1);
		x++;
	}

	if (gettimer(0) == 0) {
		settimer(0, 400);
		cadr = 1 - cadr;
		hx = x / 16;
		hy = y / 16;

		if (fishWeight == 1)
			getsprite(1, fish1[cadr]);
		else if (fishWeight == 2)
			getsprite(1, fish2[cadr]);
		else if (fishWeight == 3)
			getsprite(1, fish3[cadr]);
		else if (fishWeight == 4)
			getsprite(1, fish4[cadr]);

		getsprite(27, jellyfish[cadr]);
		getsprite(28, shark[cadr]);
		getsprite(29, shark[cadr]);
		clearscreen();
		putimage(plants[cadr], 2 - hx, 122 - hy, 10, 12);
		putimage(plants[1 - cadr], 32 - hx, 122 - hy, 10, 12);
		putimage(plants[cadr], 62 - hx, 125 - hy, 10, 12);
		putimage(plants[cadr], 92 - hx, 122 - hy, 10, 12);
		putimage(plants[1 - cadr], 112 - hx, 124 - hy, 10, 12);

		for (i = 0; i < 16; i++)
			putimagerle(wave, i * 8, random(2) - 3 - hy, 16, 8);

		for (i = 2; i < 8; i++)
			getsprite(i, planktone[random(1)]);
	}

	if (gettimer(1) == 0) {
		settimer(1, 9000 + random(1000));
		spritesetvalue(28, S_SPEEDY, 0);
		spritesetvalue(28, S_SPEEDX, -7);
		putsprite(28, 130, 10 + random(100));
		spritesetvalue(29, S_SPEEDY, 0);
		spritesetvalue(29, S_SPEEDX, 6);
		putsprite(29, -16, 10 + random(100));
	}

	if (gettimer(2) == 0) {
		settimer(2, 2000 + random(1000));
		health--;

		if (health <= 0)
			game = 0;
	}

	if (gettimer(3) == 0) {
		settimer(3, 800);
		spritespeed(27, 2, angbetweenspr(1, 27));
	}

	if (health > 60) {
		fishWeight++;
		health = 20;

		if (fishWeight == 2) {
			spritesetvalue(1, S_WIDTH, 10);
			spritesetvalue(1, S_HEIGHT, 6);
			getsprite(1, fish2[cadr]);
		} else if (fishWeight == 3) {
			spritesetvalue(1, S_WIDTH, 14);
			spritesetvalue(1, S_HEIGHT, 8);
			getsprite(1, fish3[cadr]);
		} else if (fishWeight == 4) {
			spritesetvalue(1, S_WIDTH, 18);
			spritesetvalue(1, S_HEIGHT, 8);
			getsprite(1, fish4[cadr]);
		} else {
			game = 0;
		}
	}

	testExit();
	drawHealth();
}

void gameover() {
	int i;

	for (i = 0; i < 32; i++)
		spritesetvalue(i, S_LIVES, 0);

	setimagesize(4);

	if (fishWeight > 4)
		putimagerle(fishFry, 0, 0, 32, 32);
	else
		putimagerle(deadFish, 0, 0, 32, 32);

	setimagesize(1);
	settimer(1, 1000);

	while (gettimer(1)) {
    }

	while (getkey() == 0) {
    }
}

void main() {
	loadrtttl(music, 1);
	playrtttl();

	while (1) {
		init();

		while (game) {
			step()
			putsprite(1, x, y);
			delayredraw();
		}

		gameover();
	}
}